Predicting the direction of stock price changes is an important factor , as it contributes to the development of effective strategies for stock exchange transactions and attracts much interest in incorporating variables historical series into the mathematical models or computer algorithms in order to produce estimations of expected price fluctuations .
The purpose of this study is to build a neural model for the financial market , allowing predictions of stocks closing prices future behavior negotiated in BM & FBOVESPA in the short term , using the economic and financial theory , combining technical analysis , fundamental analysis and analysis of time series , to predict price behavior , addressing the percentage of correct predictions of price series direction ( POCID or Prediction of Change in Direction ) .
The aim of this work is to understand the information available in the financial market and identify the variables that drive stock prices .
The methodology presented may be adapted to other companies and their stock .
Petrobras stock PETR4 , traded in BM & FBOVESPA , was used as a case study .
As part of this effort , configurations with different window sizes were designed , and the best performance was achieved with a window size of 3 , which the POCID index of correct direction predictions was 93.62 % for the test set and 87.50 % for a validation set .
The financial market is characterized by uncertainty , which is associated with the expectation of its future status in the short , medium and long terms .
Different prediction techniques have been applied to reduce the uncertainty of such market .
The design of models capable of capturing the market dynamics , aiming to reduce uncertainties , has been the subject matter of research and has attracted the interest of academic researchers and market professionals .
Financial analysts and investors observe the stock market trends in order to conduct purchase and sale transactions , in order to obtain financial return from such transactions .
They analyze the historical prices data and economic indicators for decision making .
Such decisions normally have two stages : firstly , a list of companies is selected based on their growth potential and economic fundamentals performance ; secondly , price changes are examined , so that a correct negotiation strategy is executed at the appropriate time ( Assaf , 2011 ; Francis , 1991 ; Frank & Norton , 2008 ; Lima , 2008 ; Matsura , 2007 ) .
In the literature , different methods have been applied to make predictions about the financial market .
Such methods may be grouped into four main categories : ( i ) Fundamental Analysis , ( ii ) Technical Analysis ( iii ) Prediction of Time Series with Traditional Models and ( iv ) Machine Learning Methods .
The Fundamental Analysis is based on the market economic factors .
Such analysis uses statistics , projections , conditions of supply and demand of goods and services and fundamentals of the economy and enterprise .
Technical Analysts , known as “ chartists , ” try to predict the market behavior by deriving patterns based on the study of charts that depict historical market data ( Assaf , 2011 ; Francis , 1991 ; Frank , 2008 ; Lima , 2008 ; Matsura , 2007 ) .
The Prediction of time series with traditional models is an attempt to design linear prediction models to track patterns in historical data .
In turn , such linear models are divided into two categories : univariate models and multivariate regression models .
Recently , various methods have been proposed under the same label of machine learning .
Such methods use a set of data samples to draw ( linear or nonlinear ) patterns so as to approximate the underlying function which generates the data .
Hellstrom and Holmstrom ( 1998 ) identified that the stock prices prediction task is not easy .
Within the scope of science , academic researchers are divided into two groups : those who believe that it is possible to design mechanisms to predict the market behavior and those who believe in the efficient market theory , proposed by Fama ( 1970 ) , according to which the price of stock follows a random ( unpredictable ) walk .
One of the implications of this theory is that the prediction based on patterns is not possible , since it is not possible for any material to include the same information and for the market to receive it in the same manner ( Morettin , 2008 ; Nayak & Braak , 2007 ) .
According to Póvoa ( 2008 ) , the efficient markets hypothesis may not be considered “ acceptable ” .
The market ’ s practical reality , especially concerning dissemination and interpretation of information , is very different from the hypothesis presented that assume an ideal world .
Nonetheless , the author affirms that the hypothesis still has its merits , contributing to the progress of academic studies .
The author argues that assuming that the present and the future may repeat the past can not be seen as unrealistic .
According to the literature , in order to make an economic prediction it is necessary to identify which variables determine or help to predict other economic variables .
This means looking to the past to identify which important variables may be used as indicators of other variables future behavior .
Furthermore , it also entails understanding the delayed influences of relationships between many variables , which are the most important ones to consider .
Many factors interact within the financial market , including political events , economic conditions , and market expectations itself ( Gujarati , 2003 ; Morettin , 2008 ; Shue , Chen , & Shiue , 2009 ; Tucnik , 2009 ) .
The biggest challenge in predicting stock prices is the complex nature of the field .
Most prediction models are rather limited when it comes to determine the direction of future prices , POCID , by virtue of the inherent difficulty in making accurate predictions , especially when major fluctuations occur .
This situation is particularly discouraging , since it is not sufficient to have low formal quantitative measures of accuracy ( chiefly theRMSE ( Root Mean Square Error ) or MAPE ( Mean Absolute Percentage Error ) ) , the model needs to have a high accuracy rate for changes in direction – POCID , as upward and downwards movements are what really matters for decision-making .
Some studies have analyzed the POCID , such as the one of Neto , Tavares , Alves , Cavalcanti , and Tsang ( 2010 ) which presented a model based on neural networks using a series of PETR4 prices and exogenous data .
The accuracy rate of POCID obtained with the model was 83 % .
Faria , Albuquerque , Gonzalez , Cavalcante , and Albuquerque ( 2009 ) presented different models for predicting the Ibovespa index based on neural networks , and attained a POCID result of 60 % .
Tsai and Chiou ( 2009 ) combined neural networks with decision trees to improve accuracy , attaining a POCID accuracy rate of 81.08 % .
Kara , Boyacioglu , and Baykan ( 2011 ) proposed the use of Artificial Neural Networks and support vector machines to predict the shares price index direction of the Istanbul Stock Exchange .
The proposed models achieved a POCID of 75.74–71.52 % for neural networks and support vector machines , respectively .
As observed , there is a latent challenge to improve the accuracy for POCID , and this challenge is the motivation for this work that aims to improve the accuracy rate in the prediction of the POCID direction .
This study proposes the design of a model based on ANN ( Artificial Neural Networks ) for the financial market , allowing short term predictions of stock closing prices future behavior negotiated in BM & FBOVESPA , utilizing economic and financial theory , combining technical analysis , fundamental analysis and analysis of time series , so as to predict the behavior of prices .
Addressing the percentage of correct predictions of the direction of price series ( POCID ) , as one of the main metrics for evaluating the performance of our model ( Eq ( 1 ) ) .
This metric is important because it has direct effects on the financial gains and losses .
This research case study is Petrobras ’ PETR4 stock .
The proposed methodology may be extended to stocks of enterprises in the same industry and adjusted to other industries .
This work considered , in addition to technical analysis , aspects of fundamental analysis .
This fact is considered a differential and a contribution to the context of forecasting stock prices , considering that the whole domain is interconnected to the share price .
In this example , one can cite the work of Atsalakis and Valavanis ( 2009 ) , where the authors presented a study of several approaches to forecasting the stock market behavior , 75 studies used technical analysis and only 18 used fundamental analysis , a much smaller proportion .
( 1 ) In this paper , the design of a model based on neural networks was carried out basing itself on tacit and explicit knowledge of the problem .
Prior studies and interviews with industry experts were conducted in order to acquire such tacit knowledge and to identify the components that may influence the future behavior of PETR4 stock prices .
The explicit knowledge was obtained and represented based on several existing theories .
Data and information allowed the construction of a database , which was submitted to pre-selection and pre-processing applying statistical analysis techniques .
With the data set , a model based on neural network was designed to predict the future stock price .
The remainder of this paper is organized as follows .
In Section 2 , related works and theoretical grounds of process modeling and prediction for the financial market is presented .
Section 3 describes the methodology used for all stages of modeling and prediction of the financial market process .
Obtained results are discussed in Section 4 .
Finally , Section 5 concludes the paper and presents the final considerations .
As already mentioned , the main methods for analyzing stocks are fundamental analysis and technical analysis .
The two techniques have historically competed for the position of leading method in pricing of financial assets ( Póvoa , 2008 ) .
The fundamental analysis works with macroeconomic , industry and enterprise-specific fundamentals .
It studies the variation factors that affect the balance between supply and demand in the market , using variables that may affect the market in the present or in the future ( Assaf , 2011 ; Francis , 1991 ; Frank , 2008 ; Lima , 2008 ; Póvoa , 2008 ) .
The technical analysis or chartist analysis is a study dedicated to observe the evolution of markets based on its graphical representation in terms of purchase price , selling price , volume traded , among others .
The technical analysis assumes the premise that investors have a fairly uniform level of information and tend to repeat past behavior .
Graphics are simple , patterns are defined ( price channels , head and shoulders , triangles , top and bottoms , gaps , flags , pennants etc .
) , which are the main tools to determine trends and future prices .
Technical analysts are essentially focused on understanding and analyzing the historical behavior of prices and volumes of assets in the past , in order to determine the current price or market conditions .
It also uses statistical methods to project the assets future price ( Francis , 1991 ; Frank , 2008 ; Lima , 2008 ; Assaf , 2011 ; Achelis , 2001 ; Murphy , 1999 ; Póvoa , 2008 ) .
Many techniques to predict the stock market have been developed using the various existing computational techniques , such as LR ( Linear Regression ) ( Clements & Hendry , 1998 ; Clements , Milas , & van Dijk , 2009 ) , ANN ( Artificial Neural Networks ) ( Faria et al. , 2009 ; Kara et al. , 2011 ) , GA ( Genetic Algorithms ) ( Nayak , Misra , & Behera , 2012 ; Yang , Wu , & Lin , 2012 ) , SVM ( Support Vector Machines ) ( Wang , Wu , & Zhang , 2005 ; Wen , Yang , Song , and Jia ( 2010 ) , CBR ( Case-Based Reasoning ) ( Goswami , Bhensdadia , & Ganatra , 2009 ) and others ( Guresen , Kayakutlu , & Daim , 2011 ) .
ANN are non-linear computational models , capable of representation based on market behavior data , without previous knowledge of the relationships among input and output variables ( Zhang , Patuwo , & Hu , 1998 ) .
ANN have been widely used and have resulted in satisfactory performance compared to other approaches , which may be seen in the literature ( Cai , Lai , & Lin , 2013 ; Chang , Liu , Lin , Fan , & Ng , 2009 ; de Oliveira , Zárate , de Azevedo Reis , & Nobre , 2011a , 2011b ; González , Crespo , Palacios , Iglesias , & Berbis , 2011 ; Kara et al. , 2011 ; Tsai & Chiou , 2009 ; Yoo , Kim , & Jan , 2005 ) .
Guresen et al .
( 2011 ) describe ANN as one of the best techniques to model the stock market , because it does not contain standard formulas and may be easily adapted to market changes .
ANN have the ability to learn by example and make interpolations and extrapolations of what they learned .
The use of ANN in the solution of a task initially involves a learning phase , which is when the network extracts the patterns , thereby creating a specific representation of the problem ( Braga , Carvalho , & Ludermir , 2007 ) .
The first model for prediction of stock price based on ANN was developed by White ( 1988 ) .
The author used a feedforward network to detect unknown regularities in stock price changes .
The goal was to analyze the daily returns of IBM stock in order to test the efficient market theory , proposed by Fama ( 1970 ) , which states that stock prices follow a random walk .
Although he has not obtained good predictive results , the research stressed the potential for such analysis .
Since then , a large number of researchers have actively participated in the development of predictive models that may be reliably applied in the stock market .
A later study conducted by Tsibouris and Zeidenberg ( 1995 ) tests the efficient market theory by analyzing six stocks of the US stock exchange , finding a capacity to predict prices based on historical series of prices .
Other studies , such as ( Kolarik & Rudorfer , 1994 ; Refenes , 1991 ; Refenes , Azema-Barac , & Zapranis , 1993 ) , observed that ANN obtain better prediction performance comparable to statistical techniques , such as the regression model and those obtained by ARIMA technique .
Nayak et al .
( 2007 ) analyzed the clustering power of stock prices series and their ability to be utilized in predictive models using temporal recognition and brute force search to make the prediction .
Kolarik and Rudorfer ( 1994 ) proposed a univariate time series prediction system using neural networks .
In their research , they decided to use a fully connected feedforward network with one hidden layer and the backpropagation algorithm for network training .
The series used by the authors corresponds to common stock closing prices of IBM from May 1961 to November 1962 .
Skabar and Cloete ( 2002 ) developed a methodology using trained neural networks , a genetic algorithm based on weight optimization was used to determine buying and selling points of financial products traded in the stock exchange .
They used four financial series where the price was compared to the returns obtained , by means of random data analysis from each one of the series .
The results indicated that the Dow Jones Industrial index was significantly higher than the expected price of the random series .
This supports the claim that some financial time series are not entirely random .
Some studies incorporated aspects of technical analysis .
For instance , Kim , Han , and Chandler ( 1998 ) used a recurrent Elman neural network to predict the price of stocks in the Japanese stock exchange .
Their method intended to find the ‘ triangle ’ graphic pattern to determine if price increases may be permanent , based on historical maximum , minimum and closing prices .
Technical indicators , such as moving averages , RSI ( relative strength index ) and other indicators were also used as input , along with the historical prices ( de Oliveira et al. , 2011a , 2011b ; González et al. , 2011 ; Kara et al. , 2011 ; Leigh , Purvis , & Ragusa , 2002 ; Nagarajan , 2005 ) .
The two main approaches based on neural networks for prediction of time series are concentrated on time windowing and on the use of recurrent neural networks .
Both attempt to capture the dynamics of the system that underlies the series ’ data ( Swingler , 1996 ) .
The neural network has as an input a representation of the system current status and as an output a prediction of the future status .
The authors Waibel ( 1988 ) , Refenes ( 1991 ) and McElroy and Wildi ( 2013 ) have shown how the temporal dimension may be transposed into a space vector .
They used a feedforward network with n inputs , such network is fed with one step at a time until the moment t , then the output unit is represented by t + 1 .
There are two types of prediction : one-step-ahead ( which uses an output neuron ) and multiple-steps-ahead .
Zhang et al .
( 1998 ) describe the two methods presented in the literature to make multiple-steps-ahead predictions .
The first is called iterative prediction and is used in the Box–Jenkins model , in which the prediction values are iteratively used as inputs for future predictions .
In this case , only one output neuron is required .
The second , known as the direct method , consists in placing several outputs in the neural network , corresponding to the prediction horizon .
According to Zhang et al .
( 1998 ) , the predictions of multiple steps ahead using the direct method may be better than the iterative method for two reasons .
Firstly , the neural network may be built directly for predictions of multiple steps ahead ; secondly , the iterative method builds only one function , which is used to predict one point at a time and , subsequently , repeats such function to predict points in the future .
Ferreira , Vasconcelos , and Adeodato ( 2005 ) presented a new prediction method using time series , which performs an evolutionary search of the minimum necessary number of dimensions to be considered in the problem of determining the spatial characteristics of the time series .
The method proposed was inspired by the theorem of F. Takens and consists in a smart hybrid model composed of an Artificial Neural Network , combined with a GA. Braga et al .
( 2007 ) described an example of prediction of the Bovespa index , where the model chosen for prediction was a feedforward network .
The MRE ( mean relative error ) obtained with the model was 1.85 .
This shows that the neural networks are capable of predicting the Ibovespa series with significant accuracy .
The comparison of the performance of traditional methods with neural networks began in the 1990s , drawing the attention of many researchers .
According to Palit ( 2005 ) , the linear prediction using nonlinear mapping of neural networks can not produce better results than the statistical algorithms .
In the opposite case , using neural networks could definitely lead to better results in dealing with data from non-linear time series when compared to traditional algorithms .
The literature shows that the use of neural networks , as a method for prediction of time series , presents interesting and satisfactory results , being a promising alternative to traditional methods ( Zhang et al. , 1998 ) .
The following steps ( Fig 1 ) were used to build a neural model capable of making predictions of stocks closing prices short term future behavior traded in BM & FBOVESPA : ( 1 ) understanding of the problem domain and identification of key variables ; ( 2 ) pre-selection and collection of samples ; ( 3 ) pre-processing of inputs ; and ( 4 ) modeling and prediction .
The following sections describe each of these steps .
Prediction process steps Fig 1 .
Prediction process steps .
Understanding the problem domain A domain analysis was conducted to capture information related to the financial market and to point out the variables that drive stock prices .
Such variables represent the possible inputs for the model being proposed .
Enterprises can be segmented according to the activities performed and economy sectors .
Each sector has variables that affect only companies inside it and the various sectoral economic indicators , macroeconomic and market .
Due to the particularity of each sector and enterprise , it was necessary to conceptualize the behavior of PETR4 stock in order to understand and be able to capture the information that influences such stock .
This process was divided into three steps : ( 1 ) capture of tacit knowledge ; ( 2 ) capture of explicit knowledge ; and ( 3 ) construction of a conceptual map based on tacit and explicit knowledge .
The following subsections describe each of these steps .
Capture of tacit knowledge Financial analysts and investors have knowledge acquired throughout their lives by experience in operating in the market , by “ tips ” received from third parties and/or even based on their so-called ‘ gut feeling ’ .
A multiple choice questionnaire was designed and made available on the internet to gather this type of knowledge .
The objective of this questionnaire was to collect the opinion of qualified professions on models , techniques and indicators used in the pricing of stocks , which may help identify the changes in stock prices in the short , medium and long term .
This questionnaire , available electronically , was sent to 50 investors and analysts working in the stock market .
The questionnaire was available on the web for 30 days , being answered by 10 professionals , representing 20 % of the initially selected universe .
The profile of respondents may be seen in Figs .
2 and 3 , where 50 % have more than 3 years of experience in the stock market and 80 % operate in the medium and short term .
The figures are compatible with initial expectations , as they represent the opinion of qualified professionals who operate in the market .
Other interesting numbers were that 100 % of the sample claimed to use technical analysis as a tool for decision-making and 80 % were satisfied with the results of their model , technique and/or indicators used in pricing or market transactions .
Chart of stock pricing experience time Fig 2 .
Chart of stock pricing experience time .
Chart with profile of financial market operation Fig 3 .
Chart with profile of financial market operation .
The opinions of the qualified public on indicators used in their pricing models are shown in Tables 1–3 , for a total of 22 indicators .
These indicators were considered to build a conceptual map , which is presented in Section 3.1.3 .
Table 1 .
Balance indicators sheet analysis used by the qualified public .
Indicators ROE return on equity Profit margin or return on sales Current liquidity ratio Immediate liquidity ratio Indebtedness ratio Price/earnings ratio Earnings per share EPS EBITDA Payout Dividend yield Cash flow from investment activities EVA ( economic value added ) Table 2 .
Macroeconomic indicators used by the qualified public .
Indicators IPCA ( extended consumer price index ) Foreign direct investments Table 3 .
Technical analysis indicators used by the qualified public .
Indicators MACD Relative strength index Stochastic index OBV index Moving averages Bollinger bands Momentum Williams ’ percent range ( % R ) 3.1.2 .
Capture of explicit knowledge The explicit knowledge was achieved by reading review , focusing on identifying the key variables that may help describe the behavior of the PETR4 stock .
As a result , was obtained the set of variables shown in Table 4 , organized according to a fundamental and technical vision .
Table 4 .
Variables identified in the study .
Technical vision Fundamentalist vision Opening price Brent oil price Closing price Actual average income of employed persons Maximum price Expanded payrolls Minimum price General price index Volume IPCA ( extended consumer price index ) Bovespa index percent variation Formal employment NYSE dow jones index Wage earners Ibovespa volume Brazilian unemployment rate US ending stocks Retail sales index MACD Fuel retail sales index Relative strength index Selic interest tax rate Stochastic index CDI interest tax rate OBV index Consumer confidence index Moving averages Future expectations index Bollinger bands Brazil energy commodities index Momentum Automobile sales Williams ’ percent range ( % R ) Domestic market automobile sales Dollar percent variation Investors participation Current liquidity ratio Immediate liquidity ratio Indebtedness ratio Price/earnings ratio Earnings per share EPS EBITDA Payout Dividend yield 3.1.3 .
Concept map based on the tacit and explicit knowledge A conceptual map was designed ( Fig 4 ) to help the understanding and representation of the set of variables that describe PETR4 stock behavior .
This map was build using the gathered information on tacit and explicit knowledge .
The map shows two distinct structures , each bringing together a set of variables related to the fundamental and technical analysis .
Stock ’ s behavior∗ Conceptual Map Fig 4 .
Stock ’ s behavior∗ Conceptual Map .
∗Stock ’ s behavior é o mais correto gramaticalmente , mas você encontra em textos Stock behavior , acredito que porque virou quase um termo padrão , assim como stock prices etc .
Não sei qual seria o mais correto usar , mas tomar o cuidado de usar da mesma forma no artigo inteiro .
Pre-selection and collection of samples The conceptual map ( Fig 4 ) shows the variables which could form the set of necessary data for building a neural model to predict the PETR4 stock .
There were 46 variables in total .
The selection of variables was based on the conceptual map and depended on the availability and access to data required to build the sample set .
Table 5 shows the variables that were selected , because they had a sufficient number of samples and the access to historical series was available .
From all the variables identified using the conceptual map , the number of variables was reduced to 15 , representing the technical vision , and 11 representing the fundamentalist vision .
Historical data were collected from sources in the public and private sectors .
The main sources of data were : Economatica , Brazil ’ s Central Bank , BM & FBOVESPA and Thomson Reuters .
Coloquei Banco Central do Brasil em português porque no site do Banco Central quando você coloca a opção inglês os textos sempre se referem ao nome do Banco central em Português .
Table 5 .
List of selected variables .
Technical vision Fundamentalist vision Opening price Brent oil price Closing price Formal employment Maximum price Selic interest tax rate Minimum price CDI interest tax rate Volume Consumer confidence index NYSE dow jones index Future expectations index US ending stocks Brazil energy commodities index MACD Automobile sales Relative strength index Domestic market automobile sales Stochastic index Dollar percentage variation OBV index Investors participation Moving averages Bollinger bands Momentum Williams ’ percent range ( % R ) Variables for which it was not possible to obtain samples , or data were insufficient and/or data were outdated were systematically excluded .
Table 6 shows the list of excluded variables .
Table 6 .
List of excluded variables in the selection .
Technical vision Fundamentalist vision Bovespa index percentage variation Actual average income of employed persons Ibovespa volume Expanded payrolls General price index IPCA ( extended consumer price index ) Wage earners Brazilian unemployment rate Retail sales index Fuel retail sales index Current liquidity ratio Immediate liquidity ratio Indebtedness ratio Price/earnings ratio Earnings per share EPS EBITDA Payout Dividend yield 3.2.1 .
Data collection The set of data samples was formed by the variables shown in Table 5 .
The historical data refer to the monthly observations of variables over the period from January 2000 to December 2011 , with 144 observations in total .
The periodicity of information is very important for the prediction process , because the lower the periodicity of the samples , the more difficult the prediction .
In the stock market , the prices may be sampled with the following periodicities : real-time , minute , hour , day , week , month etc .
In this research , the periodicity used was monthly , as most of the variables selected had their historical series available only with monthly observations , and stock prices with shorter periods were more subject to high volatility .
Cross-correlation analysis of variables The variables of the set of samples were analyzed using the cross-correlation function between the time series of the PETR4 stock closing price and other variables , to identify the relationship and statistical significance .
Table 7 shows the correlation coefficient between the variables .
The variables NYSE Dow Jones Index , MACD , Relative Strength Index , Stochastic Index , Momentum , Williams ’ Percent Range ( % R ) , Brazil Energy Commodities Index and Dollar Percentage Variation ( marked in grey in Table 7 ) show correlation coefficient below 0.6 and were discarded from the set of samples as they were shown to have low representativeness .
The variables CDI interest tax rate and SELIC interest tax rate were considered because it evaluates the magnitude of the correlation .
Thus , the neural network model was built considering the remaining 18 variables ; that is , the 17 variables listed in Table 7 plus the PETR4 .
Table 7 .
Correlation coefficient between PETR4 and other variables .
Attribute Correlation coefficient with PETR4 Minimum price 0.9939 Maximum price 0.9932 Moving averages 0.9916 Bollinger bands 0.9906 Opening price 0.9846 Volume 0.8926 OBV index 0.8661 Formal employment 0.8626 Brent oil price 0.8530 Domestic market automobile sales 0.8501 automobile sales 0.8346 Consumer confidence index 0.8090 US ending stocks 0.7893 Investors participation 0.7231 Future expectations index 0.6179 CDI interest tax rate −0.8137 Selic interest tax rate −0.8146 Brazil energy commodities index 0.5587 NYSE dow jones index 0.4217 MACD 0.3432 Momentum 0.0594 Williams ’ percent range ( % R ) 0.0492 Stochastic index −0.0115 Relative strength index −0.0461 Dollar percentage variation −0.0940 3.2.3 .
Setting the window size The window size ( number of points of monthly series that is used as input of the neural network ) is basically an empiric matter and impacts the learning and prediction capacity of the neural network ( Zhang et al .
1998 ) .
An empiric method for obtaining the lag ( delay ) and the time influence of a series is to calculate its AC ( AutoCorrelation ) function and its correlogram and to discard the lags where the PAC ( Partial AutoCorrelation ) function is statistically irrelevant ( Gujarati , 2003 ) .
Fig 5 shows the correlogram of the PETR4 stock closing price attribute .
As can be seen , the first lagt − 1 was statistically relevant .
From the second lag t − 2 on , the partial autocorrelation function drops substantially and all the following lags did not present significant values from the statistical point of view .
Correlogram of the closing price of action PETR4 Fig 5 .
Correlogram of the closing price of action PETR4 .
The same procedure was performed to determine the lag ( window size ) of each variable in the data set .
The statistical significance for all variables occurred in the second lag t − 2 at most .
Based on the empirical procedure , the window size could be set at 3 moments , i.e. , t , t − 1 and t − 2 .
In this research , the windows size chosen was changed according to W = { 1 , 2 , 3 , 4 , 5 } lags to allow assessment of the relevance of influence of time lags and ascertain if the proposed empirical procedure presented the best configuration for the model .
Pre-processing The set of samples had no missing data due to the monthly periodicity of the series , as the monthly value to be considered will always be the last sampling made in the month .
The same would not happen if the periodicity was daily , as some attributes could have missing data for holidays or days on which there was no trading .
An example is the series of the Dow Jones Index , which represents the average profitability of a stock portfolio of the New York Stock Exchange ( NYSE ) , which , due to the Brazilian holidays , will cause that the series of Brazilian prices to have missing values for such days , or vice versa .
Data normalization As the series of samples had scales with different values , it was necessary to adjust the scale of values for each series within the range [ 0.2 , 0.8 ] , based on the fact that the non-linear activation functions typically present asymptotic limits of 0 and 1 for infinity .
These values are not achieved , and values between 0.2 and 0.8 introduce the neural network ’ s ability to extrapolate ( Zárate , Dias , & Song , 2008 ; Zhang et al. , 1998 ) .
The equation for data normalization is given by ( Eq ( 2 ) ) .
( 2 ) where : V′ is the normalized value ; V the value to be normalized ; Min the minimum value of the series to be normalized ; Max the maximum value of the series to be normalized ; nMax the maximum value of the range ; and nMin the minimum value of the range .
Model based on ANN The following subsections describe the neural model proposed to perform the prediction of the closing price of PETR4 stock .
The direct method was used to build the model of prediction of the stock closing value , which is described in Eq ( 3 ) .
( 3 ) where : : refers to the predicted value of the stock price for the prediction horizon h. In this work , h = 1 ; Yt corresponds to the stock closing price serie ; corresponds to a serie of the variable i ; t for t = 1 ... wi , where each value corresponds to the observation periods of the serie .
Since Wi ∊ { 1,2,3,4,5 } is the set containing the window sizes considered in the tests , it is possible to determine Eqs .
( 4 ) and ( 5 ) .
( 4 ) ( 5 ) 3.4.1 .
Establishing the training and tests set The set of samples underwent the windowing process , taking into consideration the window sizes W = { 1 , 2 , 3 , 4 , 5 } and the prediction horizon defined as t + 1 .
The variable used as expected output for the training and test set was the PETR4 stock closing price .
Subsequently , was used a holdout testing procedure ( Rezende , 2003 ) , in which the set of samples was divided into two subsets , selected randomly , without replacement , with about 2/3 of the data for training and 1/3 for testing .
Notice that , for each value of window size the number of observations is defined as { 142 , 141 , 140 , 139 , 138 } , respectively .
Establishing the network architecture The neural network model chosen for prediction was the feedforward multilayer perceptron , due to its efficiency in the process of prediction of time series , and its inherent ability to learn and recognize from non-linear data .
This model was also chosen by Kolarik and Rudorfer ( 1994 ) , Hoptroff ( 1992 ) , Waibel ( 1988 ) , Refenes ( 1991 ) and Swingler ( 1996 ) .
The network structure ( Fig 6 ) is composed of 3 layers , including an input layer , a hidden layer and an output layer .
The number of neurons in the input layer is determined by the window size ( period in months ) multiplied by the number of series in the set of samples .
The number of neurons in the hidden layer is determined by the equation : ( 6 ) where m and N represent the number of neurons of the output and input layer , respectively .
This equation was proposed by Huang ( 2003 ) and was used due to significant evidence , its use improves the network learning process .
The number of neurons in the output layer is determined by the size of the prediction horizon .
The activation function chosen was the log-sigmoidal function .
Structure of the proposed network Fig 6 .
Structure of the proposed network .
Training strategies Learning was performed by supervised process , where the intended inputs and outputs are entered in the network .
The algorithm chosen for the network training was the resilient backpropagation , an adaptation of the standard backpropagation algorithm .
It seeks to eliminate the negative influence of the partial derivative in the adjustment of weights .
For network convergence , the number of epochs was set at 10,000 or the minimum error rate at 0.0001 .
In other words , the training ended when one of these two conditions were met .
To implement the neural networks of this work we used the Encog Artificial Intelligence Framework ( Encog , 2009 ) .
Determination of the model ’ s performance metrics To evaluate the performance of the model neural , four measures were used : MAPE , RMSE , THEIL Coefficient e POCID .
The Mean Absolute Percentage Error ( MAPE ) , shown in Eq ( 6 ) , is the mean or average of the absolute percentage errors of forecasts .
Error is defined as actual or observed value minus the forecasted value .
Percentage absolute errors are added to compute MAPE .
This measure is easy to understand because it provides the error in terms of percentages .
Also , because absolute percentage errors are used , the problem of positive and negative errors canceling each other out is avoided .
( 7 ) The Root Mean Square Error ( RMSE ) , shown in Eq ( 7 ) , is employed as an indicator for the predictive power or prediction agreement .
A low RMSE indicates that the prediction agrees with the real data .
( 8 ) The THEIL coefficient , Eq ( 8 ) , evaluates the prediction performance in relation to the trivial prediction , meaning that the estimated future value is equal to the current value .
( 9 ) where : If THEIL = 1 , the model has a performance equal to a trivial prediction , if THEIL > 1 , the performance is worse than a trivial prediction ; and if THEIL < 1 , the performance is better than a trivial prediction .
The Percentage of Correct ( up/down ) Directional Prediction – POCID , shown in Eq ( 9 ) , measures the percentage of accuracy relating to the series trend .
( 10 ) Where : ( 11 )
This section presents the results according to the methodology described in this paper .
Experiments to evaluate the window size Extensive experiments were conducted with the aim of evaluating the best window size to predict the PETR4 stock closing price .
Experiments were performed for window sizes W = { 1 , 2 , 3 , 4 , 5 } .
A total of 144 observation time frames were used in the experiment , corresponding to the period from January 2000 to December 2011 .
As mentioned , the algorithm chosen for network training was the resilient backpropagation algorithm .
The results of the training processes are shown in Table 8 .
For all window sizes considered , the network converged with a maximum of 6,000 epochs .
The model with window size equal to 5 presented the lowest training error , although it is very close to the errors presented for windows 1 , 2 and 4 .
Table 8 .
Comparison of the Network Training Results .
Window MSE Epochs 1 0.0001000 6028 2 0.0000999 4240 3 0.0001001 3487 4 0.0001000 6051 5 0.0000998 2450 The results of the validation process are shown in Table 9 .
For all window sizes , THEIL metric shows that the models proposed are better than a trivial prediction or a random choice , being confirmed by the performance metric of trend prediction ( THEIL < 1 ) and POCID directional prediction .
Table 9 .
Comparison of the Network Neural Validation Result .
Window MAPE ( % ) RMSE THEIL POCID ( % ) 1 6.41 0.04931799 0.04983509 87.50 2 5.58 0.04333996 0.02605494 89.36 3 5.45 0.04485328 0.03249950 93.62 4 5.60 0.04036768 0.04228181 91.49 5 5.63 0.04142632 0.03793813 84.78 Confirming the procedure indicated in Section 3.2.3 relating to the choice of the time window size from the models proposed , the best performance , based on the set of error metrics , for prediction is the model with window size equal to 3 , as it presents a POCID direction correct rate of 93.62 % , and MAPE of 5.45 % .
Fig 7 shows the comparison chart between the actual data and the prediction performed for the model ’ s test set with a window size equal to 3 .
As can be seen , the values predicted by the neural network followed the trend of PETR4 closing price series .
Chart with prediction of the test set with window size equal to 3 Fig 7 .
Chart with prediction of the test set with window size equal to 3 .
Experiments to evaluation the representativeness of the model To verify the significance level of the model , 10 training and test sets selected randomly were generated again , the average POCID error was 92.77 % and confidence interval ±2.50 % for a significance level of 95 % .
Table 10 presents the points for which the neural model failed to identify the correct trend direction .
An analysis of the context and of the relevant facts in the period shows that the errors are due to atypical market conditions .
On December 2000 , there was a crisis connected to the change of the enterprise name from Petrobras to PetroBrax and the 4 % drop in fuel prices , causing the stock price to fall in this month , though the trend in this period was upward .
On November 2007 , the discovery of the Tupi field , a giant oil reserve below the salt layer of the Campos Basin , was announced , causing the stock price to increase abnormally , and this fact created an upward trend that was only stopped with the beginning of the 2008 crisis .
Table 10 .
Divergent points of the test set .
Date Actual Predicted Difference December 2000 3.31 3.75 0.44 November 2007 30.75 28.36 −2.39 4.3 .
Validation of the model In order to better validate the results of the neural model with window size equal to 3 , a new test basis for the period of January 2012 to November 2012 was composed , with a total of 11 observations .
The data were presented to the network and the results are shown in Table 11 .
It is possible to observe , as expected , that the indicators presented poorer performance compared to the test model composed of the original dataset , but the POCID direction correct rate was 87.50 % , considered satisfactory .
As seen in Fig 8 , the actual data and the prediction follow the same trend , diverging only in 1 point , the residues presented higher dispersion , as revealed byMAPE e RMSE indicators .
Therefore , the chart of the actual and predicted values has a greater distance between the series .
Table 11 .
Results of network evaluation with window size equal to 3 .
MAPE RMSE THEIL POCID 26.47 % 0.10498327 0.98139441 87.50 % Chart of prediction of the evaluation set with window size equal to 3 Fig 8 .
Chart of prediction of the evaluation set with window size equal to 3 .
Table 12 presents the divergent point in the trend direction for the model validation set with window size equal to 3 .
An analysis of the context and of the relevant facts in the period shows that the errors were also due to atypical market conditions .
In October 2012 , oil production contracted to an average of 1,843 million barrels a day , the lowest since April 2008 , which caused the stock price to drop in this month .
Table 12 .
Divergent points of the evaluation set .
Date Actual Predicted Difference October 2012 20.80 22.58 1.78 The observation of the results presented in this research evidences that the proposed methodology was evaluated through empirical analysis of the results achieved , showing a good rate of the stock price changes , with POCID of 93.62 % .
This was confirmed for the different window sizes proposed , underscoring the suitability of the methodology for creating models for prediction of future stock market values .
In this research , we sought to understand the set of information present in the financial market and identify the variables that drive stock prices , taking into account the activities performed and economy sectors , the various industry , macroeconomic and market indicators .
The methodology presented may be adapted to other enterprises and their stocks .
Theoretically , the discussion on the predictions of stock prices is still controversial and unproductive .
However , from the empirical standpoint , this research proved to be very productive , with some methods for financial market prediction being developed and demonstrated .
Predicting the direction into which stock prices change is very important for the development of effective strategies to operate in the stock market .
The result of the questionnaire applied to qualified respondents revealed that 80 % of the respondents believe that the models and methods they use are satisfactory , but they do not use computer techniques to operate in the stock market .
The assertive prediction of stock prices may promise attractive benefits for investors in general .
The methodology presented for use of Artificial Neural Networks to predict the closing price of PETR4 , traded on BM & FBOVESPA , adopted 4 prediction steps : ( 1 ) understanding the problem domain ; ( 2 ) pre-selection and collection of samples ; ( 3 ) pre-processing of inputs ; and ( 4 ) modeling and prediction .
Considering the case study of PETR4 stock , the model that achieved the best performance was window size equal to 3 , which showed a POCID direction correct rate of 93.62 % , and MAPE of 5.45 % .
The chart of predicted values and actual values shows that the predicted series follows the series of actual values .
Analyzing the results obtained in the experiments , it is possible to notice that the RMSE errors are relatively low .
However , the prediction behavior is best viewed with the MAPE metric , as it displays better a sense of deviation from the model .
The results show excellent correct direction rates and meets the objectives of this research .
It is important to note that not all the variables studied in this work could be used , by virtue of the economic characteristics of Brazil , from the structural instability of an economy that has not yet reached a stage of maturity to the lack of sufficiently long time series .
In general , the results were satisfactory as they successfully achieved the objective of this research to predict the closing price of the PETR4 , following its behavior and tendency .
Thus , the use of ANN to predict the behavior and trends of stocks has shown to be a feasible alternative to conventional techniques , revealing the market behavior and offering privileged information to investors , in addition to the possibility of being used in combination with other techniques .
1 Tel .
: +55 31 3439 5204 .